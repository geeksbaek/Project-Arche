<article>  
  <div horizontal center-justified center layout fit id='spinner'>
      <paper-spinner active></paper-spinner>
  </div>
  
  <google-sheets id='sheet1' key="1li0V6toRcReouvLw3DPbA2Pe0u90OPx0frNu8FXh4_M" tabid="1" published></google-sheets>
  <google-sheets id='sheet2' key="1li0V6toRcReouvLw3DPbA2Pe0u90OPx0frNu8FXh4_M" tabid="2" published></google-sheets>
  <google-sheets id='sheet3' key="1qfKC9pqM9atEeTLY3sVNEneUe98R_tTiS7fyiDe_C2w" tabid="7" published></google-sheets>
  
  <paper-tabs id="scrollableTabs" selected="{{selectedChart}}" noink role="tablist" horizontal center layout>
      <paper-tab role="tab" inline flex center-center horizontal layout>플레이어 랭킹</paper-tab>
      <paper-tab role="tab" inline flex center-center horizontal layout>원정대 랭킹</paper-tab>
<!--
      <paper-tab role="tab" inline flex center-center horizontal layout>세력 비율</paper-tab>
      <paper-tab role="tab" inline flex center-center horizontal layout>인구 변동</paper-tab>
      <paper-tab role="tab" inline flex center-center horizontal layout>원정대 전투점수</paper-tab>
      <paper-tab role="tab" inline flex center-center horizontal layout>레벨 분포</paper-tab>
-->
  </paper-tabs>

  <core-animated-pages selected="{{selectedChart}}" style='height: calc(100% - 48px)'>
    <div>
<!--
      <div horizontal center-justified layout class='panel'>
        <paper-input-decorator label="Search" id="search-noarta">
          <input is="core-input" on-change="{{searchNoarta}}" data-default="all-noarta"></input>
        </paper-input-decorator>
      </div>
-->
      <template is="auto-binding">
		<google-sheets key="1qfKC9pqM9atEeTLY3sVNEneUe98R_tTiS7fyiDe_C2w" tabid="5" rows="{{rows}}" published></google-sheets>
		<table class='table table-condensed table-hover' id='datatable1' style='display: none;'>
          <thead>
            <tr>
              <th>순위</th>
              <th>이름</th>
              <th>세력</th>
              <th class='sub'>원정대</th>
              <th class='sub'>종족</th>
              <th class='sub'>직업</th>
              <th>장비점수 (↓)</th>
              <th class='sub'>날짜</th>
            </tr>
          </thead>
          <tbody>
            <template repeat="{{row, i in rows}}">
              <template if="{{row.gsx$timestamp.$t}}">
                <tr class="all-noarta [[row.gsx$server.$t | serverTranslate]]" data-name="[[row.gsx$name.$t]]">
                  <td>[[row.gsx$rank.$t]]위</td>
                  <td>
                    <a href='[[row.gsx$url.$t]]' target='_blank' title='[[row.gsx$name.$t]]'>[[row.gsx$name.$t]]</a>
                  </td>
                  <td>[[row.gsx$nation.$t]]</td>
                  <td class='sub'>[[row.gsx$expedition.$t]]</td>
                  <td class='sub'>[[row.gsx$race.$t]]</td>
                  <td class='sub'>[[row.gsx$class.$t]]</td>
                  <td style='font-weight: bold'>[[row.gsx$score.$t | comma]]</td>
                  <td class='sub'>[[row.gsx$timestamp.$t | parseDate]]</td>
                </tr>
              </template>
            </template>
          </tbody>
		</table>
      </template>
    </div>
    <div>
      <template is="auto-binding">
        <google-sheets key="1qfKC9pqM9atEeTLY3sVNEneUe98R_tTiS7fyiDe_C2w" tabid="6" rows="{{rows}}" published></google-sheets>
        <table class='table table-condensed table-hover' id='datatable2'>
          <thead>
            <tr>
              <th>세력</th>
              <th>원정대</th>
              <th class='sub'>인원</th>
              <th class='sub'>길드레벨</th>
              <th>장비정수 총합 (↓)</th>
              <th class='sub'>장비점수 평균</th>
              <th class='sub'>날짜</th>
            </tr>
          </thead>
          <tbody>
            <template repeat="{{row, i in rows}}">	
              <template if="{{row.gsx$timestamp.$t}}">			
                <tr class="all-expedition [[row.gsx$server.$t | serverTranslate]]">
                  <td>[[row.gsx$nation.$t]]</td>
                  <td>
                    <a href='[[row.gsx$url.$t]]' target='_blank' title='[[row.gsx$expedition.$t]]'>[[row.gsx$expedition.$t]]</a>
                  </td>
                  <td class='sub'>[[row.gsx$total.$t | comma]]명</td>
                  <td class='sub'>[[row.gsx$glevel.$t]]</td>
                  <td style='font-weight: bold'>[[row.gsx$scoresum.$t | comma]] <span class='small'>({{ {arr: rows, target: 'gsx$scoresum', value: row.gsx$scoresum.$t} | getRankIndex }}위)</span></td>
                  <td class='sub'>[[row.gsx$scoreavg.$t | parseInt | comma]] <span class='small'>({{ {arr: rows, target: 'gsx$scoreavg', value: row.gsx$scoreavg.$t} | getRankIndex }}위)</span></td>
                  <td class='sub'>[[row.gsx$timestamp.$t | parseDate]]</td>
                </tr>
              </template>
            </template>
          </tbody>
        </table>
      </template>
    </div>
<!--
    <div style='overflow: hidden'>
      <google-chart 
        id='pieChart' 
        type='pie'
        options='{"pieHole": "0.4",
                 "legend": { "position": "top", "maxLines": 3, "alignment": "center" },
                 "fontName": "Nanum Gothic",
                 "chartArea": { "left": "15%", "top": "15%", "width": "70%", "height": "70%" } }'>
      </google-chart>
    </div>
    <div>
      <google-chart 
        id='lineChart' 
        type='line'
        options='{"curveType": "function",
                 "legend": { "position": "top", "maxLines": 3, "alignment": "center" },
                 "fontName": "Nanum Gothic",
                 "hAxis": { "format": "yyyy-MM-dd", "textPosition": "out" },
                 "chartArea": { "left": "15%", "top": "15%", "width": "70%", "height": "70%" } }'>
      </google-chart>
    </div>
    <div>
      <google-chart 
        id='bubbleChart' 
        type='bubble'
        options='{"legend": { "position": "top", "maxLines": 3, "alignment": "center" },
                 "vAxis": { "title": "1인당 전투점수" },
                 "hAxis": { "title": "전투점수" },
                 "bubble": { "textStyle": {"fontSize": "11"} },
                 "fontName": "Nanum Gothic",
                 "chartArea": { "left": "15%", "top": "15%", "width": "70%", "height": "70%" } }'>
      </google-chart>    
    </div>
    <div>
      <google-chart 
        id='barChart' 
        type='bar'
        options='{"isStacked": "true",
                 "legend": { "position": "top", "maxLines": 3, "alignment": "center" },
                 "fontName": "Nanum Gothic",
                 "chartArea": { "left": "15%", "top": "15%", "width": "70%", "height": "70%" } }'>
      </google-chart>
    </div>
-->
  </core-animated-pages>
  
  <style>
	google-chart {
      height: 100%;
      width: 100%;
	}
    paper-tabs {
      background-color: #31B404;
      color: white;
    }
    core-animated-pages {
      overflow: auto; 
    }
    core-animated-pages > div {
      max-width: 900px;
    }
    paper-tabs::shadow #selectionBar {
      background-color: #E3F6CE;      
    }
  </style>
  
  <script>    
//	function calcChart1(nations) {
//      var json = [
//        ['세력', '55레벨', '50~54레벨', '40~49레벨', '20~39레벨', '1~19레벨']
//      ];
//      
//      for(var i in nations) {
//        if(i == '하리하라 연합' || i == '누이아 연합' || i == '무법자') {
//          json.push([
//            i == '하리하라 연합' ? '하리하라' : i == '누이아 연합' ? '누이아' : '무법자', nations[i].lv55, 
//            nations[i].lv50to54, nations[i].lv40to49, nations[i].lv30to39 + nations[i].lv20to29, 
//            nations[i].lv10to19 + nations[i].lv1to9
//          ]);	
//        }
//      }
//      
//      return json;
//	}
//
//	function calcChart2(expeditions) {
//      var json = [
//        ['원정대', '전투점수', '1인당 전투점수', '세력', '총원']
//      ];
//      
//      for(var i in expeditions) {
//        var total = expeditions[i].lv55 + expeditions[i].lv50to54 + expeditions[i].lv40to49 + 
//            expeditions[i].lv30to39 + expeditions[i].lv20to29 + expeditions[i].lv10to19 + expeditions[i].lv1to9;
//        if((expeditions[i].nation == '하리하라 연합' || expeditions[i].nation == '누이아 연합' || expeditions[i].nation == '무법자') 
//           && expeditions[i].battle >= 1000 && total > 2) {
//          json.push([
//            i,
//            expeditions[i].battle,
//            parseInt((expeditions[i].battle / total).toFixed(0)),
//            expeditions[i].nation,
//            total
//          ]);
//        }
//      }
//      
//      return json;
//	}
//    
//    function calcChart3(data) {
//      var json = [
//        ['date', /*'총합',*/ '하리하라 연합', '누이아 연합', '무법자'] 
//      ];
//      
//      for(var i = 0; i < data.length; i++) {
//        json.push([
//          new Date(data[i].gsx$date.$t),
//          //parseInt(data[i].gsx$total.$t),
//          parseInt(data[i].gsx$west.$t),
//          parseInt(data[i].gsx$east.$t),
//          parseInt(data[i].gsx$pirate.$t)
//        ]);
//      }
//      
//      return json;
//    }
//					
	var sheet1 = document.querySelector('#sheet1');
	var sheet2 = document.querySelector('#sheet2');
	var sheet3 = document.querySelector('#sheet3');
	var pieChart = document.querySelector('#pieChart');
//    
//	var barChart = document.querySelector('#barChart');
//	var bubbleChart = document.querySelector('#bubbleChart');
//	var lineChart = document.querySelector('#lineChart');
//
//	sheet1.addEventListener('google-sheet-data', function(e) {
//      var data = this.rows;
//      var nations = {};
//      var expeditions = {};
//
//      for(var i = 0; i < data.length; i++) {
//        nations[data[i].gsx$nation.$t] = {
//          battle: data[i].gsx$battle.$t,
//          lv55: parseInt(data[i].gsx$lv55.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv55 : 0),
//          lv50to54: parseInt(data[i].gsx$lv50to54.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv50to54 : 0),
//          lv40to49: parseInt(data[i].gsx$lv40to49.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv40to49 : 0),
//          lv30to39: parseInt(data[i].gsx$lv30to39.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv30to39 : 0),
//          lv20to29: parseInt(data[i].gsx$lv20to29.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv20to29 : 0),
//          lv10to19: parseInt(data[i].gsx$lv10to19.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv10to19 : 0),
//          lv1to9: parseInt(data[i].gsx$lv1to9.$t) + (nations[data[i].gsx$nation.$t] ? nations[data[i].gsx$nation.$t].lv1to9 : 0),
//        }
//        
//        expeditions[data[i].gsx$expedition.$t] = {
//          nation: data[i].gsx$nation.$t,
//          url: data[i].gsx$url.$t,
//          master: data[i].gsx$master.$t,
//          battle: parseInt(data[i].gsx$battle.$t),
//          lv55: parseInt(data[i].gsx$lv55.$t),
//          lv50to54: parseInt(data[i].gsx$lv50to54.$t),
//          lv40to49: parseInt(data[i].gsx$lv40to49.$t),
//          lv30to39: parseInt(data[i].gsx$lv30to39.$t),
//          lv20to29: parseInt(data[i].gsx$lv20to29.$t),
//          lv10to19: parseInt(data[i].gsx$lv10to19.$t),
//          lv1to9: parseInt(data[i].gsx$lv1to9.$t),
//        }
//      }
//
//      barChart.data = calcChart1(nations);
//      barChart.drawChart();
//
//      bubbleChart.data = calcChart2(expeditions);
//      bubbleChart.drawChart();
//	});
//    
//    sheet2.addEventListener('google-sheet-data', function(e) {
//      var data = this.rows;
//      var nations = {};
//
//      lineChart.data = calcChart3(data);
//      lineChart.drawChart();
//    });
    
//    sheet3.addEventListener('google-sheet-data', function(e) {
//      var data = this.rows;
//
//      pieChart.cols = [{"label": "종족", "type": "string"},{"label": "수", "type": "number"}];
//      pieChart.rows = ([
//          ["하리하란", parseInt(data[0].gsx$hariharan.$t)], 
//          ["페레", parseInt(data[0].gsx$ferre.$t)], 
//          ["누이안", parseInt(data[0].gsx$nuian.$t)], 
//          ["엘프", parseInt(data[0].gsx$elf.$t)]
//      ]);        
//      
//    });
//    
//    document.querySelector('#chartTab').addEventListener('core-select', function(e) {
//      console.log('draw');
//      pieChart.drawChart();
//    });

	sheet1.addEventListener('google-sheet-data', function(e) {    
      var spinner = document.querySelector('#spinner');
      document.querySelector('#datatable1').style.display = '';
      spinner.style.display = 'none';
      document.querySelector('#scrollableTabs').selected = 0;
	});
  </script>
</article>